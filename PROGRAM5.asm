;Program 5
INCLUDE Irvine32.inc
INCLUDE MACROS.INC

DISPLAYSHAPE MACRO
	PUSH EAX
	MOV EAX, YELLOW + (BLUE * 16)	;FOREGROUND/BACKGROUND
	CALL SETTEXTCOLOR
	POP EAX

	MOV EDX, OFFSET SHAPE
	CALL WRITESTRING

	PUSH EAX
	MOV EAX, WHITE + (BLACK)	;FOREGROUND/BACKGROUND
	CALL SETTEXTCOLOR
	POP EAX



	
	ENDM

DISPLAYobject MACRO
	MOV EDX, OFFSET object
	CALL WRITESTRING
	
	ENDM




DRAWBORDER MACRO
LOCAL L1, L2
	MOV DH, 0
	MOV DL, 0
	MOV ECX, 79

	L1:
	MOV DH, 0
	CALL GOTOXY
	MWRITE '*'
	MOV DH, 24
	CALL GOTOXY
	MWRITE '*'
	INC DL
	LOOP L1
	MOV ECX, 24

	L2:
	MOV DL, 0
	CALL GOTOXY
	MWRITE '*'
	MOV DL, 79
	CALL GOTOXY
	MWRITE '*'
	DEC DH
	LOOP L2
	ENDM




.data
ROW DB ?
COL DB ?
FROW DB ?
FCOL DB ?
SHAPE DB '[**]' ,0
object DB '0', 0
BORDER DB '*', 0



.code
MAIN PROC
	
	

	CALL CLRSCR
	DRAWBORDER
	MOV DH, 12
	MOV DL, 20
	CALL GOTOXY
	MOV ROW, DH				;SAVE THE REGISTER EDX
	MOV COL, DL
	DISPLAYSHAPE
	CALL MOVEIT
	CALL JUMP



	EXIT


main endp

MOVEIT PROC
GET_KEY:
	CALL READCHAR

	CMP AL, 't'
	JE MOVE_UP
	CMP AL, 'g'
	JE MOVE_DOWN
	CMP AL, 'f'
	JE MOVE_LEFT
	CMP AL, 'h'
	JE MOVE_RIGHT
	JMP EXIT1

MOVE_UP:
	CALL CLRSCR
	DRAWBORDER
	MOV DH, ROW
	SUB DH, 1

	MOV DL, COL
	CALL GOTOXY
	MOV ROW, DH   ; SAVE DX
	MOV COL, DL
	DISPLAYSHAPE
	JMP GET_KEY

MOVE_DOWN:
	CALL CLRSCR
	DRAWBORDER
	MOV DH, ROW
	ADD DH, 1

	MOV DL, COL
	CALL GOTOXY
	MOV ROW, DH   ; SAVE DX
	MOV COL, DL
	DISPLAYSHAPE
	JMP GET_KEY

MOVE_RIGHT:
	CALL CLRSCR
	DRAWBORDER
	MOV DH, ROW
	MOV DL, COL
	ADD DL, 2
	CALL GOTOXY
	MOV ROW, DH
	MOV COL, DL
	DISPLAYSHAPE
	JMP GET_KEY

MOVE_LEFT:
	CALL CLRSCR
	DRAWBORDER
	MOV DH, ROW
	MOV DL, COL
	SUB DL, 2
	CALL GOTOXY
	MOV ROW, DH
	MOV COL, DL
	DISPLAYSHAPE
	JMP GET_KEY


	


	EXIT1:
		RET
	MOVEIT ENDP

	JUMP PROC
		GETKEY:
			CALL READCHAR

			CMP AL, 'J'
			JE DIVE
			MOV EBX, 10

		DIVE:
			CALL CLRSCR
			DRAWBORDER
			MOV DH, ROW
			ADD DH, 1
			MOV DL, COL
		CALL GOTOXY
		MOV ROW, DH   ; SAVE DX
		MOV COL, DL
		CALL GOTOXY
		DISPLAYSHAPE
		MOV EAX, 400 
		CALL DELAY
		CMP ROW, 23
		JE EXIT2
		JNE DIVE
		EXIT2:
		RET
	JUMP ENDP








end main
